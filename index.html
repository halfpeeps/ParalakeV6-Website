<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paralake V6 Development Archive</title>
    <link rel="icon" type="image/x-icon" href="/images/06 Other/Logos/ph_icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Sono:wght@200..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<style>
    body {
        display: flex;
        flex-direction: column;
        font-family: 'Sono', serif;
        background: #121212;
        color: #fff;
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
    #header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 2px 20px;
        background: #333;
        color: white;
        font-size: 28px;
        border-bottom: 2px solid #444;
        font-family: "Jost", serif;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    #container {
        display: flex;
        flex: 1;
        overflow-y: auto;
    }
    #sidebar {
        width: 300px;
        background: #222;
        padding: 10px;
        overflow-y: auto;
        display: block;
        position: sticky;
        top: 0;
        z-index: 5;
    }
    .folder {
        cursor: pointer;
        padding: 5px;
        display: block;
        position: relative;
        border-radius: 5px;
    }
    .folder:hover, .folder.active {
        background: #444;
        border-radius: 5px;
    }
    .folder.parent-folder:hover {
        background: #555;
    }
    .folder-icon {
        margin-right: 0px;
    }
    .toggle-button {
        cursor: pointer;
        margin-right: 5px;
        user-select: none;
    }
    .nested {
        display: none;
        padding-left: 50px;
    }
    .expanded > .nested {
        display: block;
    }
    #image-container {
        flex: 1;
        flex-wrap: wrap;
        padding: 10px;
        border-radius: 0 8px 8px 0;
    }
    img {
        max-width: 600px;
        max-height: 200px;
        margin: 10px;
        border: 1px solid #303030;
        border-radius: 10px;
        cursor: pointer;
    }
    #footer {
        background: #333;
        color: white;
        padding: 10px;
        text-align: center;
        position: sticky;
        bottom: 0;
        width: 100%;
        border-top: 2px solid #444;
        box-sizing: border-box;
        font-family: "Jost", serif;
        font-weight: 600;
    }
    #footer a {
        color: #fff;
        margin: 0 15px;
        text-decoration: none;
        font-size: 14px;
    }
    #footer a:hover {
        text-decoration: underline;
    }
    /* image popout stuff, i dont entirely understand it but it seems to work */
    #image-preview {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
    }
    .preview-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        max-width: 90%;
        max-height: 90%;
    }
    #preview-img {
        max-width: 90%;
        max-height: 80vh;
        border-radius: 10px;
    }
    .image-description {
        margin-top: 15px;
        color: white;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 16px;
        max-width: flex;
        text-align: center;
        display: none;
    }
    .image-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        max-width: 90%;
        max-height: 90%;
    }
    #image-preview .close {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        font-size: 64px;
        cursor: pointer;
        z-index: 1001;
    }
    #contact-popup {
        font-family: "Jost", serif;
    }
    #close-button {
        background-color: red;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #close-button:hover {
        background-color: rgb(160, 0, 0);
    }
</style>
</head>
<body>
    <div id="header">
        <span>Paralake V6 Development Archive</span>
        <a href="#">
            <img src="/images/06 Other/Logos/phv6.png" alt="Logo" style="height: 45px;">
        </a>
    </div>
    <div id="container">
        <div id="sidebar"></div>
        <div id="image-container"></div>
    </div>

    <div id="footer">
        <p>Created by peeps</p>
        <div>
            <a href="#" target="_blank">Map Download</a>
            <a href="https://perpheads.com/" target="_blank">PERPHeads Forums</a>
            <a href="#" id="contact-link">Contact</a>
        </div>
    </div>

    <!--image popup-->
    <div id="image-preview">
        <span class="close">&times;</span>
        <div class="preview-content">
            <img id="preview-img" src="" alt="Preview">
        </div>
    </div>
    

    <div id="contact-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: #333; padding: 20px; border-radius: 10px; width: 80%; max-width: 400px; position: relative;">
            <img src="https://perpheads.com/data/avatars/l/10/10255.jpg?1717343207" alt="Profile Image" style="position: absolute; top: 10px; right: 10px; width: 66px; height: 66px; border-radius: 50%; border: 2px solid #fff;">
            <h3 style="color: white; margin-right: 70px;">Contact Links</h3>
            <ul style="list-style-type: none; padding: 0;">
                <li><a href="https://steamcommunity.com/id/halfpeeps/" target="_blank" style="color: white;">Steam</a></li>
                <li><a href="https://perpheads.com/members/peeps.10255/" target="_blank" style="color: white;">PERPHeads Forums</a></li>
                <li><a href="https://discordapp.com/users/241526229558231051/" target="_blank" style="color: white;">Discord</a></li>
            </ul>
            <button id="close-button" onclick="closePopup()">Close</button>
        </div>
    </div>
    

    <script>
    async function loadImages() {
        const response = await fetch('file_list.json');
        const fileTree = await response.json();
        const sidebar = document.getElementById('sidebar');
        const imageContainer = document.getElementById('image-container');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const closeBtn = document.querySelector('#image-preview .close');
        const imageDescription = document.createElement('p');
        
        imageDescription.classList.add('image-description');

        let imageFiles = [];
        let currentIndex = -1;
        
        function cleanFolderName(folderName) {
            return folderName.replace(/^\d+\s*/, '');
        }

        function createFolderElement(folderPath, parentElement) {
            const rawFolderName = folderPath.split('/').pop();
            const folderName = cleanFolderName(rawFolderName);
            const folderElement = document.createElement('div');
            folderElement.classList.add('folder');

            const folderHeader = document.createElement('div');
            folderHeader.style.display = 'flex';
            folderHeader.style.alignItems = 'center';
            folderHeader.style.justifyContent = 'flex-start';

            const toggleButton = document.createElement('span');
            toggleButton.classList.add('toggle-button');

            const hasSubfolders = Object.keys(fileTree).some(key => key.startsWith(folderPath + '/') && key !== folderPath);
            const hasImages = fileTree[folderPath] && fileTree[folderPath].length > 0;

            if (hasSubfolders) {
                toggleButton.textContent = '[+]';
                folderElement.classList.add('parent-folder');
            }

            const folderLabel = document.createElement('span');
            folderLabel.innerHTML = `<span class='folder-icon'>üìÅ</span> ${folderName}`;
            folderLabel.style.flexGrow = "1";
            folderLabel.style.textAlign = "left";

            if (hasSubfolders) {
                folderHeader.appendChild(toggleButton);
            }
            folderHeader.appendChild(folderLabel);
            folderElement.appendChild(folderHeader);

            const nestedContainer = document.createElement('div');
            nestedContainer.classList.add('nested');
            folderElement.appendChild(nestedContainer);
            parentElement.appendChild(folderElement);

            if (hasSubfolders) {
                toggleButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (folderElement.classList.contains('expanded')) {
                        folderElement.classList.remove('expanded');
                        toggleButton.textContent = '[+]';
                    } else {
                        document.querySelectorAll('.folder').forEach(f => {
                            if (!f.contains(folderElement) && !folderElement.contains(f)) {
                                f.classList.remove('expanded');
                                const toggleBtn = f.querySelector('.toggle-button');
                                if (toggleBtn) toggleBtn.textContent = '[+]';
                            }
                        });
                        folderElement.classList.add('expanded');
                        toggleButton.textContent = '[-]';
                    }
                });
            }

            if (hasImages) {
                folderElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('.folder').forEach(f => f.classList.remove('active'));
                    folderElement.classList.add('active');

                    imageContainer.innerHTML = '';
                    imageFiles = [];

                    if (fileTree[folderPath] && fileTree[folderPath].length > 0) {
                        fileTree[folderPath].forEach(file => {
                            const img = document.createElement('img');
                            img.src = `images/${folderPath}/${file.filename}`;
                            img.onclick = () => {
                                currentIndex = imageFiles.findIndex(image => image.src === img.src); // Correctly find the clicked image index
                                previewImg.src = imageFiles[currentIndex].src;
                                if (imageFiles[currentIndex].description) {
                                    imageDescription.textContent = imageFiles[currentIndex].description;
                                    imageDescription.style.display = 'block'; // Show when there's a description
                                } else {
                                    imageDescription.style.display = 'none'; // Hide when empty
                                }
                                imagePreview.style.display = 'flex';
                            };
                            imageFiles.push({ src: img.src, description: file.description });
                            imageContainer.appendChild(img);
                        });
                    }
                });
            } else {
                folderElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (folderElement.classList.contains('expanded')) {
                        folderElement.classList.remove('expanded');
                        toggleButton.textContent = '[+]';
                    } else {
                        document.querySelectorAll('.folder').forEach(f => {
                            if (!f.contains(folderElement) && !folderElement.contains(f)) {
                                f.classList.remove('expanded');
                                const toggleBtn = f.querySelector('.toggle-button');
                                if (toggleBtn) toggleBtn.textContent = '[+]';
                            }
                        });
                        folderElement.classList.add('expanded');
                        toggleButton.textContent = '[-]';
                    }
                });
            }

            return nestedContainer;
        }

        const descriptionContainer = document.createElement('div');
        descriptionContainer.appendChild(imageDescription);
        imagePreview.appendChild(descriptionContainer);

        // arrow keys and esc
        document.addEventListener('keydown', (e) => {
            if (imagePreview.style.display === 'flex' && currentIndex !== -1) {
                if (e.key === 'ArrowRight' && currentIndex < imageFiles.length - 1) {
                    currentIndex++; 
                } else if (e.key === 'ArrowLeft' && currentIndex > 0) {
                    currentIndex--; 
                } else if (e.key === 'Escape') {
                    imagePreview.style.display = 'none';
                    return;
                }
                
                previewImg.src = imageFiles[currentIndex].src;
                
                if (imageFiles[currentIndex].description) {
                    imageDescription.textContent = imageFiles[currentIndex].description;
                    imageDescription.style.display = 'block'; 
                } else {
                    imageDescription.style.display = 'none'; 
                }
            }
        });

        const folderElements = {};
        const folders = Object.keys(fileTree);
        const miscFolders = [];
        const otherFolders = [];

        folders.forEach(folder => {
            if (folder.includes('Misc')) {
                miscFolders.push(folder);
            } else {
                otherFolders.push(folder);
            }
        });

        const allFolders = otherFolders.concat(miscFolders);

        allFolders.forEach(folder => {
            if (folder !== "") {
                const parentFolder = folder.substring(0, folder.lastIndexOf('/'));
                const parentElement = folderElements[parentFolder] || sidebar;
                folderElements[folder] = createFolderElement(folder, parentElement);
            }
        });

        closeBtn.addEventListener('click', () => {
            imagePreview.style.display = 'none';
        });

        imagePreview.addEventListener('click', (e) => {
            if (e.target === imagePreview) {
                imagePreview.style.display = 'none';
            }
        });

    }

    document.getElementById('contact-link').addEventListener('click', function (event) {
        event.preventDefault();
        document.getElementById('contact-popup').style.display = 'flex';
    });

    function closePopup() {
        document.getElementById('contact-popup').style.display = 'none';
    }

    loadImages();

    </script>
    
</body>
</html>
